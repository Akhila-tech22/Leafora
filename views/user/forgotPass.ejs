<style>
    :root {
      --primary-color: #8B6F47;
      --primary-dark: #705836;
      --secondary-color: #F5F1EB;
      --text-color: #2E2E2E;
      --text-muted: #6B6B6B;
      --border-color: #E8DFD5;
      --error-color: #e74c3c;
  }
  
  body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      /* background: linear-gradient(135deg, #8B6F47 0%, #705836 100%); */
      background: lightgrey;
      line-height: 1.6;
      color: var(--text-color);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
  }
  
  .content-main {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
  }
  
  .card-login {
      background-color: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 400px;
      padding: 40px;
      transition: all 0.3s ease;
  }
  
  .card-login:hover {
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.35);
  }
  
  .card-title {
      text-align: center;
      color: var(--text-color);
      font-size: 26px;
      margin-bottom: 12px;
      font-weight: 700;
  }
  
  .form-control {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 16px;
      background: var(--secondary-color);
      color: var(--text-color);
      transition: all 0.3s ease;
      outline: none;
  }
  
  .form-control:focus {
      border-color: var(--primary-color);
      background: white;
      box-shadow: 0 0 0 3px rgba(139, 111, 71, 0.1);
  }
  
  .btn-primary {
      width: 100%;
      /* background: linear-gradient(135deg, #8B6F47 0%, #705836 100%); */
      background: lightslategray;
      color: white;
      border: none;
      padding: 14px 16px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
  }
  
  .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(139, 111, 71, 0.3);
  }

  .btn-primary:active {
      transform: translateY(0);
  }
  
  .text-center {
      text-align: center;
      margin-top: 20px;
      color: var(--text-muted);
  }
  
  .text-center a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
  }
  
  .text-center a:hover {
      text-decoration: underline;
      color: var(--primary-dark);
  }
  
  .error-message {
      color: var(--error-color);
      font-size: 14px;
      margin-top: 8px;
      text-align: left;
  }
  
  .is-invalid {
      border-color: var(--error-color) !important;
  }
  
  .is-invalid:focus {
      box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
  }
  
  @media (max-width: 480px) {
      .card-login {
          padding: 30px 20px;
          margin: 15px;
      }

      .card-title {
          font-size: 22px;
      }
  }
</style>



<section class="content-main" style="margin-top: 80px; margin-bottom: 80px;">
  <div class="card mx-auto card-login col-4">
    <div class="card-body">
      <h4 class="card-title mb-4">Forgot Password?</h4>
      <p style="font-size: small; color: #6B6B6B;" class="card-title mb-4">Enter the email address you used when you joined and we'll send you instructions to reset your password</p>
      <form id="forgotPasswordForm" method="post" action="/forgot-email-valid">
        <div class="mb-3">
          <input class="form-control" name="email" placeholder="Email" type="text" id="email">
          <div class="error-message" id="email-error"></div>
          <div class="error-message" id="email-existence-error"></div>
        </div>
        <div class="mb-4">
          <button type="submit" class="btn btn-primary w-100">Verify</button>
        </div>
      </form>
      <p class="text-center mb-4">Don't have an account? <a href="/register">Sign up</a></p>
    </div>
  </div>
</section>

<script>
  document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const emailInput = document.getElementById('email');
    const emailError = document.getElementById('email-error');
    const emailExistenceError = document.getElementById('email-existence-error');
    const emailValue = emailInput.value.trim();
    const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;

    // Reset errors
    emailError.textContent = '';
    emailExistenceError.textContent = '';
    emailInput.classList.remove('is-invalid');

    // Basic validation
    if (emailValue === '') {
      emailError.textContent = 'Please enter your email.';
      emailInput.classList.add('is-invalid');
      return;
    } else if (!emailValue.match(emailPattern)) {
      emailError.textContent = 'Please enter a valid email address.';
      emailInput.classList.add('is-invalid');
      return;
    }

    // Check if email exists in database
    try {
      const response = await fetch('/check-email-existence', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email: emailValue })
      });

      const data = await response.json();

      if (!data.exists) {
        emailExistenceError.textContent = 'This email is not registered with us.';
        emailInput.classList.add('is-invalid');
        return;
      }

      // If email exists, submit the form
      this.submit();
    } catch (error) {
      console.error('Error checking email existence:', error);
      emailExistenceError.textContent = 'Error verifying email. Please try again.';
      emailInput.classList.add('is-invalid');
    }
  });
</script>